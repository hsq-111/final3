<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>登录 - 健身管理系统</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- 引入Font Awesome图标库 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <div class="form-container">
      <div class="text-center mb-6">
        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-dumbbell text-blue-600 text-2xl"></i>
        </div>
        <h1 class="text-2xl font-bold text-gray-900">健身管理系统</h1>
        <p class="text-gray-500 mt-2">请登录您的账号</p>
      </div>
      
      <form id="login-form">
        <div class="form-group">
          <label for="username" class="form-label">用户名</label>
          <input type="text" id="username" name="username" class="form-input" placeholder="请输入用户名" required>
          <div id="username-error" class="error-message"></div>
        </div>
        
        <div class="form-group">
          <label for="password" class="form-label">密码</label>
          <div class="input-group">
            <input type="password" id="password" name="password" class="form-input" placeholder="请输入密码" required>
            <i id="toggle-password" class="fas fa-eye-slash password-toggle"></i>
          </div>
          <div id="password-error" class="error-message"></div>
        </div>
        
        <button type="submit" id="login-button" class="btn btn-primary btn-block">
          登录
        </button>
        
        <div class="text-center mt-4">
          <p class="text-gray-600">
            还没有账号？ <a href="register.html" class="text-blue-600 font-medium">立即注册</a>
          </p>
        </div>
      </form>
    </div>
  </div>

  <script src="js/app.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 获取表单元素
      const loginForm = DOM.get('#login-form');
      const usernameInput = DOM.get('#username');
      const passwordInput = DOM.get('#password');
      const togglePasswordButton = DOM.get('#toggle-password');
      const usernameError = DOM.get('#username-error');
      const passwordError = DOM.get('#password-error');
      const loginButton = DOM.get('#login-button');
      
      // 切换密码可见性
      DOM.on(togglePasswordButton, 'click', function() {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        
        // 切换图标
        if (type === 'text') {
          togglePasswordButton.classList.remove('fa-eye-slash');
          togglePasswordButton.classList.add('fa-eye');
        } else {
          togglePasswordButton.classList.remove('fa-eye');
          togglePasswordButton.classList.add('fa-eye-slash');
        }
      });
      
      // 表单验证
      DOM.on(usernameInput, 'input', function() {
        const username = this.value.trim();
        usernameError.textContent = '';
        
        if (username.length === 0) {
          usernameError.textContent = '用户名不能为空';
          return;
        }
        
        const validation = Validation.username(username);
        if (!validation.valid) {
          usernameError.textContent = validation.message;
        }
      });
      
      DOM.on(passwordInput, 'input', function() {
        const password = this.value;
        passwordError.textContent = '';
        
        if (password.length === 0) {
          passwordError.textContent = '密码不能为空';
          return;
        }
        
        const validation = Validation.password(password);
        if (!validation.valid) {
          passwordError.textContent = validation.message;
        }
      });
      
      // 表单提交处理
      DOM.on(loginForm, 'submit', function(e) {
        e.preventDefault();
        
        // 表单验证
        let isValid = true;
        
        // 验证用户名
        const username = usernameInput.value.trim();
        if (username.length === 0) {
          usernameError.textContent = '用户名不能为空';
          isValid = false;
        } else {
          const validation = Validation.username(username);
          if (!validation.valid) {
            usernameError.textContent = validation.message;
            isValid = false;
          }
        }
        
        // 验证密码
        const password = passwordInput.value;
        if (password.length === 0) {
          passwordError.textContent = '密码不能为空';
          isValid = false;
        } else {
          const validation = Validation.password(password);
          if (!validation.valid) {
            passwordError.textContent = validation.message;
            isValid = false;
          }
        }
        
        // 如果表单验证通过，提交登录请求
        if (isValid) {
          handleLogin(username, password);
        }
      });
      
      // 处理登录请求
      async function handleLogin(username, password) {
        try {
          // 禁用登录按钮并显示加载状态
          DOM.disableButton(loginButton, '<i class="fas fa-spinner fa-spin mr-2"></i>登录中...');
          
          // 调用登录API
          const result = await Auth.login(username, password);
          
          if (result.success) {
            // 登录成功，显示成功提示并跳转到首页
            Toast.success('登录成功，正在跳转...', 1500);
            setTimeout(() => {
              window.location.href = 'dashboard.html';
            }, 1500);
          } else {
            // 登录失败，显示错误提示
            Toast.error(result.message || '登录失败，请检查用户名和密码');
            // 启用登录按钮
            DOM.enableButton(loginButton);
          }
        } catch (error) {
          console.error('Login error:', error);
          Toast.error('登录失败，请稍后重试');
          // 启用登录按钮
          DOM.enableButton(loginButton);
        }
      }
    });
  </script>
</body>
</html>