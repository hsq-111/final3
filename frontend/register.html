<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>注册 - 健身管理系统</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- 引入Font Awesome图标库 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <div class="form-container">
      <div class="text-center mb-6">
        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-user-plus text-blue-600 text-2xl"></i>
        </div>
        <h1 class="text-2xl font-bold text-gray-900">创建账号</h1>
        <p class="text-gray-500 mt-2">注册您的健身管理系统账号</p>
      </div>
      
      <form id="register-form">
        <div class="form-group">
          <label for="username" class="form-label">用户名</label>
          <input type="text" id="username" name="username" class="form-input" placeholder="请设置用户名" required>
          <div id="username-error" class="error-message"></div>
        </div>
        
        <div class="form-group">
          <label for="password" class="form-label">密码</label>
          <div class="input-group">
            <input type="password" id="password" name="password" class="form-input" placeholder="请设置密码" required>
            <i id="toggle-password" class="fas fa-eye-slash password-toggle"></i>
          </div>
          <div id="password-error" class="error-message"></div>
        </div>
        
        <div class="form-group">
          <label for="confirm-password" class="form-label">确认密码</label>
          <div class="input-group">
            <input type="password" id="confirm-password" name="confirm-password" class="form-input" placeholder="请再次输入密码" required>
            <i id="toggle-confirm-password" class="fas fa-eye-slash password-toggle"></i>
          </div>
          <div id="confirm-password-error" class="error-message"></div>
        </div>
        
        <button type="submit" id="register-button" class="btn btn-primary btn-block">
          注册
        </button>
        
        <div class="text-center mt-4">
          <p class="text-gray-600">
            已有账号？ <a href="login.html" class="text-blue-600 font-medium">立即登录</a>
          </p>
        </div>
      </form>
    </div>
  </div>

  <script src="js/app.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 获取表单元素
      const registerForm = DOM.get('#register-form');
      const usernameInput = DOM.get('#username');
      const passwordInput = DOM.get('#password');
      const confirmPasswordInput = DOM.get('#confirm-password');
      const togglePasswordButton = DOM.get('#toggle-password');
      const toggleConfirmPasswordButton = DOM.get('#toggle-confirm-password');
      const usernameError = DOM.get('#username-error');
      const passwordError = DOM.get('#password-error');
      const confirmPasswordError = DOM.get('#confirm-password-error');
      const registerButton = DOM.get('#register-button');
      
      // 切换密码可见性
      DOM.on(togglePasswordButton, 'click', function() {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        
        // 切换图标
        if (type === 'text') {
          togglePasswordButton.classList.remove('fa-eye-slash');
          togglePasswordButton.classList.add('fa-eye');
        } else {
          togglePasswordButton.classList.remove('fa-eye');
          togglePasswordButton.classList.add('fa-eye-slash');
        }
      });
      
      // 切换确认密码可见性
      DOM.on(toggleConfirmPasswordButton, 'click', function() {
        const type = confirmPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        confirmPasswordInput.setAttribute('type', type);
        
        // 切换图标
        if (type === 'text') {
          toggleConfirmPasswordButton.classList.remove('fa-eye-slash');
          toggleConfirmPasswordButton.classList.add('fa-eye');
        } else {
          toggleConfirmPasswordButton.classList.remove('fa-eye');
          toggleConfirmPasswordButton.classList.add('fa-eye-slash');
        }
      });
      
      // 表单验证
      DOM.on(usernameInput, 'input', function() {
        const username = this.value.trim();
        usernameError.textContent = '';
        
        if (username.length === 0) {
          usernameError.textContent = '用户名不能为空';
          return;
        }
        
        const validation = Validation.username(username);
        if (!validation.valid) {
          usernameError.textContent = validation.message;
        }
      });
      
      DOM.on(passwordInput, 'input', function() {
        const password = this.value;
        passwordError.textContent = '';
        
        if (password.length === 0) {
          passwordError.textContent = '密码不能为空';
          return;
        }
        
        const validation = Validation.password(password);
        if (!validation.valid) {
          passwordError.textContent = validation.message;
        }
        
        // 检查密码一致性
        checkPasswordMatch();
      });
      
      DOM.on(confirmPasswordInput, 'input', function() {
        checkPasswordMatch();
      });
      
      // 检查密码是否一致
      function checkPasswordMatch() {
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        confirmPasswordError.textContent = '';
        
        if (confirmPassword.length === 0) {
          confirmPasswordError.textContent = '请确认密码';
          return;
        }
        
        if (password !== confirmPassword) {
          confirmPasswordError.textContent = '两次输入的密码不一致';
        }
      }
      
      // 表单提交处理
      DOM.on(registerForm, 'submit', function(e) {
        e.preventDefault();
        
        // 表单验证
        let isValid = true;
        
        // 验证用户名
        const username = usernameInput.value.trim();
        if (username.length === 0) {
          usernameError.textContent = '用户名不能为空';
          isValid = false;
        } else {
          const validation = Validation.username(username);
          if (!validation.valid) {
            usernameError.textContent = validation.message;
            isValid = false;
          }
        }
        
        // 验证密码
        const password = passwordInput.value;
        if (password.length === 0) {
          passwordError.textContent = '密码不能为空';
          isValid = false;
        } else {
          const validation = Validation.password(password);
          if (!validation.valid) {
            passwordError.textContent = validation.message;
            isValid = false;
          }
        }
        
        // 验证确认密码
        const confirmPassword = confirmPasswordInput.value;
        if (confirmPassword.length === 0) {
          confirmPasswordError.textContent = '请确认密码';
          isValid = false;
        } else if (password !== confirmPassword) {
          confirmPasswordError.textContent = '两次输入的密码不一致';
          isValid = false;
        }
        
        // 如果表单验证通过，提交注册请求
        if (isValid) {
          handleRegister(username, password);
        }
      });
      
      // 处理注册请求
      async function handleRegister(username, password) {
        try {
          // 禁用注册按钮并显示加载状态
          DOM.disableButton(registerButton, '<i class="fas fa-spinner fa-spin mr-2"></i>注册中...');
          
          // 调用注册API
          const result = await Auth.register(username, password);
          
          if (result.success) {
            // 注册成功，显示成功提示并跳转到登录页
            Toast.success('注册成功，请登录...', 1500);
            setTimeout(() => {
              window.location.href = 'login.html';
            }, 1500);
          } else {
            // 注册失败，显示错误提示
            Toast.error(result.message || '注册失败，请稍后重试');
            // 启用注册按钮
            DOM.enableButton(registerButton);
          }
        } catch (error) {
          console.error('Register error:', error);
          Toast.error('注册失败，请稍后重试');
          // 启用注册按钮
          DOM.enableButton(registerButton);
        }
      }
    });
  </script>
</body>
</html>